---
timestamp: 'Fri Nov 07 2025 17:41:30 GMT-0500 (Eastern Standard Time)'
content_id: 43281c0ade3310fec4b76f549d66344c558b0ceadfa8c6fd7edc21d61c2b2801
---

# file: src/syncs/interests.sync.ts

```typescript
import { actions, Frames, Sync } from "@engine";
import { Requesting, Session, UserInterest } from "@concepts";

const INVALID_SESSION_ERROR = "Invalid session. Please sign in.";

// ---------------------------------------------------------------------------
// Personal Interests
// ---------------------------------------------------------------------------

export const RequestAddPersonalInterest: Sync = ({
  request,
  session,
  tag,
  currentUser,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/addPersonalInterest", session, tag },
    { request },
  ]),
  where: async (frames) => await frames.query(Session._getUser, { session }, { user: currentUser }),
  then: actions([
    UserInterest.addPersonalInterest,
    { user: currentUser, tag },
  ]),
});

export const AddPersonalInterestGuardResponse: Sync = ({
  request,
  session,
  tag,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/addPersonalInterest", session, tag },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

export const AddPersonalInterestResponse: Sync = ({ request, personalInterest }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/addPersonalInterest" }, { request }],
    [UserInterest.addPersonalInterest, {}, { personalInterest }],
  ),
  then: actions([Requesting.respond, { request, personalInterest }]),
});

export const AddPersonalInterestErrorResponse: Sync = ({ request, error }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/addPersonalInterest" }, { request }],
    [UserInterest.addPersonalInterest, {}, { error }],
  ),
  then: actions([Requesting.respond, { request, error }]),
});

export const RequestRemovePersonalInterest: Sync = ({
  request,
  session,
  tag,
  currentUser,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/removePersonalInterest", session, tag },
    { request },
  ]),
  where: async (frames) => await frames.query(Session._getUser, { session }, { user: currentUser }),
  then: actions([
    UserInterest.removePersonalInterest,
    { user: currentUser, tag },
  ]),
});

export const RemovePersonalInterestGuardResponse: Sync = ({
  request,
  session,
  tag,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/removePersonalInterest", session, tag },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

export const RemovePersonalInterestResponse: Sync = ({ request }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/removePersonalInterest" }, { request }],
    [UserInterest.removePersonalInterest, {}, {}],
  ),
  then: actions([Requesting.respond, { request, success: true }]),
});

export const RemovePersonalInterestErrorResponse: Sync = ({ request, error }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/removePersonalInterest" }, { request }],
    [UserInterest.removePersonalInterest, {}, { error }],
  ),
  then: actions([Requesting.respond, { request, error }]),
});

// ---------------------------------------------------------------------------
// Item Interests
// ---------------------------------------------------------------------------

export const RequestAddItemInterest: Sync = ({
  request,
  session,
  item,
  currentUser,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/addItemInterest", session, item },
    { request },
  ]),
  where: async (frames) =>
    await frames.query(Session._getUser, { session }, { user: currentUser }),
  then: actions([
    UserInterest.addItemInterest,
    { user: currentUser, item },
  ]),
});

export const AddItemInterestGuardResponse: Sync = ({
  request,
  session,
  item,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/addItemInterest", session, item },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

export const AddItemInterestResponse: Sync = ({ request, itemInterest }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/addItemInterest" }, { request }],
    [UserInterest.addItemInterest, {}, { itemInterest }],
  ),
  then: actions([Requesting.respond, { request, itemInterest }]),
});

export const AddItemInterestErrorResponse: Sync = ({ request, error }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/addItemInterest" }, { request }],
    [UserInterest.addItemInterest, {}, { error }],
  ),
  then: actions([Requesting.respond, { request, error }]),
});

export const RequestRemoveItemInterest: Sync = ({
  request,
  session,
  item,
  currentUser,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/removeItemInterest", session, item },
    { request },
  ]),
  where: async (frames) =>
    await frames.query(Session._getUser, { session }, { user: currentUser }),
  then: actions([
    UserInterest.removeItemInterest,
    { user: currentUser, item },
  ]),
});

export const RemoveItemInterestGuardResponse: Sync = ({
  request,
  session,
  item,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/removeItemInterest", session, item },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

export const RemoveItemInterestResponse: Sync = ({ request }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/removeItemInterest" }, { request }],
    [UserInterest.removeItemInterest, {}, {}],
  ),
  then: actions([Requesting.respond, { request, success: true }]),
});

export const RemoveItemInterestErrorResponse: Sync = ({ request, error }) => ({
  when: actions(
    [Requesting.request, { path: "/UserInterest/removeItemInterest" }, { request }],
    [UserInterest.removeItemInterest, {}, { error }],
  ),
  then: actions([Requesting.respond, { request, error }]),
});

// ---------------------------------------------------------------------------
// Queries
// ---------------------------------------------------------------------------

const emptyResultsFrame = (
  original: Record<symbol, unknown>,
  target: symbol,
) => new Frames({ ...original, [target]: [] });

export const RequestGetPersonalInterests: Sync = ({
  request,
  session,
  currentUser,
  personalInterest,
  results,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/_getPersonalInterests", session },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    frames = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (frames.length === 0) return new Frames();

    frames = await frames.query(UserInterest._getPersonalInterests, { user: currentUser }, { personalInterest });
    if (frames.length === 0) {
      return emptyResultsFrame(original, results);
    }

    return frames.collectAs([personalInterest], results);
  },
  then: actions([Requesting.respond, { request, results }]),
});

export const GetPersonalInterestsGuardResponse: Sync = ({
  request,
  session,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/_getPersonalInterests", session },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

export const RequestGetItemInterests: Sync = ({
  request,
  session,
  currentUser,
  itemInterest,
  results,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/_getItemInterests", session },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    frames = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (frames.length === 0) return new Frames();

    frames = await frames.query(UserInterest._getItemInterests, { user: currentUser }, { itemInterest });
    if (frames.length === 0) {
      return emptyResultsFrame(original, results);
    }

    return frames.collectAs([itemInterest], results);
  },
  then: actions([Requesting.respond, { request, results }]),
});

export const GetItemInterestsGuardResponse: Sync = ({
  request,
  session,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/_getItemInterests", session },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

export const RequestGetUsersInterestedInItem: Sync = ({
  request,
  session,
  item,
  currentUser,
  interestedUser,
  results,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/_getUsersInterestedInItems", session, item },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    frames = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (frames.length === 0) return new Frames();

    frames = await frames.query(UserInterest._getUsersInterestedInItems, { item }, { user: interestedUser });
    if (frames.length === 0) {
      return emptyResultsFrame(original, results);
    }

    return frames.collectAs([interestedUser], results);
  },
  then: actions([Requesting.respond, { request, results }]),
});

export const GetUsersInterestedInItemGuardResponse: Sync = ({
  request,
  session,
  item,
  currentUser,
  errorMessage,
}) => ({
  when: actions([
    Requesting.request,
    { path: "/UserInterest/_getUsersInterestedInItems", session, item },
    { request },
  ]),
  where: async (frames) => {
    const original = (frames[0] ?? {}) as Record<symbol, unknown>;
    const authenticated = await frames.query(Session._getUser, { session }, { user: currentUser });
    if (authenticated.length === 0) {
      return new Frames({ ...original, [errorMessage]: INVALID_SESSION_ERROR });
    }
    return new Frames();
  },
  then: actions([Requesting.respond, { request, error: errorMessage }]),
});

```
